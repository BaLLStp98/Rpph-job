<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test ResumeDeposit API</title>
</head>
<body>
    <h1>Test ResumeDeposit API</h1>
    
    <div>
        <h2>Test 1: Get all resume deposits</h2>
        <button onclick="testGetAll()">Get All Resume Deposits</button>
        <div id="result1"></div>
    </div>
    
    <div>
        <h2>Test 2: Get resume deposits by email</h2>
        <input type="email" id="emailInput" placeholder="Enter email" value="test@example.com">
        <button onclick="testGetByEmail()">Get by Email</button>
        <div id="result2"></div>
    </div>
    
    <div>
        <h2>Test 3: Test register?department simulation</h2>
        <button onclick="testDepartment()">Test Department Load</button>
        <div id="result3"></div>
    </div>

    <script>
        async function testGetAll() {
            try {
                const response = await fetch('/api/resume-deposit');
                const data = await response.json();
                document.getElementById('result1').innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
            } catch (error) {
                document.getElementById('result1').innerHTML = 'Error: ' + error.message;
            }
        }
        
        async function testGetByEmail() {
            try {
                const email = document.getElementById('emailInput').value;
                const response = await fetch(`/api/resume-deposit?email=${encodeURIComponent(email)}`);
                const data = await response.json();
                document.getElementById('result2').innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
            } catch (error) {
                document.getElementById('result2').innerHTML = 'Error: ' + error.message;
            }
        }
        
        async function testDepartment() {
            try {
                // Simulate the loadResumeByDepartment function
                const userEmail = 'test@example.com'; // Mock email
                const userName = 'John Doe'; // Mock name
                
                console.log('üîç ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:', { email: userEmail, name: userName });
                
                // Step 1: Try to get by email
                const res = await fetch(`/api/resume-deposit?email=${encodeURIComponent(userEmail)}`);
                if (res.ok) {
                    const json = await res.json();
                    const list = json?.data || json || [];
                    console.log('üîç ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö:', list.length, '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                    
                    if (list.length > 0) {
                        const found = list[0];
                        console.log('‚úÖ ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏≠‡∏µ‡πÄ‡∏°‡∏•:', found.id);
                        document.getElementById('result3').innerHTML = 
                            '<h3>Found by email:</h3><pre>' + JSON.stringify(found, null, 2) + '</pre>';
                    } else {
                        // Step 2: Try to get by name
                        console.log('üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•...');
                        const nameRes = await fetch('/api/resume-deposit');
                        if (nameRes.ok) {
                            const nameJson = await nameRes.json();
                            const nameList = nameJson?.data || nameJson || [];
                            
                            const firstName = 'John';
                            const lastName = 'Doe';
                            
                            const nameFiltered = nameList.filter((r) => {
                                const rFirstName = (r?.firstName || '').trim();
                                const rLastName = (r?.lastName || '').trim();
                                return rFirstName.toLowerCase() === firstName.toLowerCase() && 
                                       rLastName.toLowerCase() === lastName.toLowerCase();
                            });
                            
                            if (nameFiltered.length > 0) {
                                const found = nameFiltered[0];
                                console.log('‚úÖ ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:', found.id);
                                document.getElementById('result3').innerHTML = 
                                    '<h3>Found by name:</h3><pre>' + JSON.stringify(found, null, 2) + '</pre>';
                            } else {
                                document.getElementById('result3').innerHTML = '<h3>No data found</h3>';
                            }
                        }
                    }
                } else {
                    document.getElementById('result3').innerHTML = 'API Error: ' + res.status;
                }
            } catch (error) {
                document.getElementById('result3').innerHTML = 'Error: ' + error.message;
            }
        }
    </script>
</body>
</html>
